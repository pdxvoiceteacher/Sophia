{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "consensus_summary_v1.schema.json",
  "title": "Consensus Summary v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema", "bundle_hash", "computed_at_utc", "inputs", "central", "peers", "consensus", "policy_gate"],
  "properties": {
    "schema": { "type": "string", "const": "consensus_summary_v1" },
    "bundle_hash": { "$ref": "#/$defs/sha256_hex" },
    "computed_at_utc": { "$ref": "#/$defs/rfc3339_utc_z" },
    "inputs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["central_attestations_present", "peer_attestations_present"],
      "properties": {
        "central_attestations_present": { "type": "boolean" },
        "peer_attestations_present": { "type": "boolean" }
      }
    },
    "central": { "$ref": "#/$defs/tally_v1" },
    "peers": {
      "type": "object",
      "additionalProperties": false,
      "required": ["total", "pass", "fail", "pending", "weighted_pass", "weighted_fail", "weighted_pending"],
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "pass": { "type": "integer", "minimum": 0 },
        "fail": { "type": "integer", "minimum": 0 },
        "pending": { "type": "integer", "minimum": 0 },
        "weighted_pass": { "type": "number" },
        "weighted_fail": { "type": "number" },
        "weighted_pending": { "type": "number" }
      }
    },
    "consensus": { "type": "string", "enum": ["convergent", "divergent", "insufficient"] },
    "policy_gate": {
      "type": "object",
      "additionalProperties": false,
      "required": ["network_profile", "required_for", "satisfied"],
      "properties": {
        "network_profile": { "type": "string", "enum": ["witness_only", "reproducible_audit", "full_relay"] },
        "required_for": { "type": "array", "items": { "type": "string" } },
        "satisfied": { "type": "boolean" }
      }
    }
  },
  "$defs": {
    "sha256_hex": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
    "rfc3339_utc_z": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$" },
    "tally_v1": {
      "type": "object",
      "additionalProperties": false,
      "required": ["total", "pass", "fail", "pending"],
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "pass": { "type": "integer", "minimum": 0 },
        "fail": { "type": "integer", "minimum": 0 },
        "pending": { "type": "integer", "minimum": 0 }
      }
    }
  }
}
